- name: Debug - Check project structure
  run: |
    echo "=== Project structure before build ==="
    pwd
    ls -la
    echo "=== web/ directory ==="
    ls -la web/ || echo "No web/ directory"
    echo "=== pubspec.yaml ==="
    head -20 pubspec.yaml

- name: Build Flutter Web
  run: |
    echo "ðŸ—ï¸ Building Flutter Web..."
    # Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ web Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñƒ
    flutter create --platforms=web .
    
    echo "=== Starting build ==="
    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐ±Ð¾Ñ€ÐºÑƒ Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð»Ð¾Ð³
    flutter build web \
      --release \
      --base-href /mtg_stats/ 2>&1 | tee build_log.txt
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ¾Ð´ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ
    BUILD_EXIT_CODE=$?
    echo "Build exit code: $BUILD_EXIT_CODE"
    
    if [ $BUILD_EXIT_CODE -ne 0 ]; then
      echo "âŒ Build failed! Last 50 lines of log:"
      tail -50 build_log.txt
      exit 1
    fi

- name: Check build output
  run: |
    echo "ðŸ“ Build directory content:"
    # Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð»Ð¸ Ð¿Ð°Ð¿ÐºÐ°
    if [ -d "build/web" ]; then
      ls -la build/web/
      echo ""
      if [ -f "build/web/main.dart.js" ]; then
        echo "âœ… main.dart.js found! Size: $(du -h build/web/main.dart.js | cut -f1)"
      else
        echo "âŒ main.dart.js NOT FOUND in build/web!"
        echo "Files in build/web:"
        find build/web -type f | head -20
      fi
    else
      echo "âŒ build/web directory does not exist!"
      echo "Checking build directory:"
      ls -la build/ 2>/dev/null || echo "No build directory at all"
    fi